/*
 * Consumer Data Standards
 * Sample CLI tool to Demonstrate the Consumer Data Right APIs
 *
 * NOTE: This class is auto generated by the codegen artefact
 * https://github.com/ConsumerDataStandardsAustralia/java-artefacts/codegen
 */
package au.org.consumerdatastandards.client.cli;

import ch.qos.logback.classic.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.shell.standard.ShellCommandGroup;
import org.springframework.shell.standard.ShellComponent;
import org.springframework.shell.standard.ShellMethod;
import org.springframework.shell.standard.ShellOption;

@ShellComponent
@ShellCommandGroup("Auth- and security-related Functions")
public class Auth extends ApiCliBase {

    private static final Logger LOGGER = (Logger) LoggerFactory.getLogger(Auth.class);

    @ShellMethod("Set verifyingSsl, e.g. true, false")
    public void verifyingSsl(@ShellOption String verifyingSsl) {
        apiClientOptions.setVerifyingSsl(Boolean.getBoolean(verifyingSsl));
        LOGGER.info("VerifyingSsl is set to {}", verifyingSsl);
    }

    @ShellMethod("Setup client certificate and CA to enable MTLS connection to the server")
    public void setupMTLS(@ShellOption("root CA file path") String rootCaPath,
                          @ShellOption("client cert file path") String certFilePath,
                          @ShellOption("client key file path") String keyFilePath,
                          @ShellOption(value = "enable MTLS or not", defaultValue = "true") boolean mtlsEnabled) {
        apiClientOptions.setRootCaFilePath(rootCaPath);
        LOGGER.info("Root CA file path is set to {}", rootCaPath);
        apiClientOptions.setCertFilePath(certFilePath);
        LOGGER.info("Client certificate file path is set to {}", certFilePath);
        apiClientOptions.setKeyFilePath(keyFilePath);
        LOGGER.info("Client key file path is set to {}", keyFilePath);
        if (mtlsEnabled) {
            enableMTLS();
        } else {
            disableMTLS();
        }
    }

    @ShellMethod("Enable MTLS")
    public void enableMTLS() {
        apiClientOptions.setMtlsEnabled(true);
        LOGGER.info("MTLS enabled");
    }

    @ShellMethod("Disable MTLS")
    public void disableMTLS() {
        apiClientOptions.setMtlsEnabled(false);
        LOGGER.info("MTLS disabled");
    }

    @ShellMethod("Set access token to send as the Authorization: Bearer header (Property: access.token)")
    public void accessToken(@ShellOption String jwt) {
        apiClientOptions.setAccessToken(jwt);
    }

    @ShellMethod("Get currently set access token. The refresh token flow can update access token.")
    public String getAccessToken() {
        return apiClientOptions.getAccessToken();
    }

    @ShellMethod("Set the base URL of the OIDC Server (Property: auth.server)")
    public void authServer(@ShellOption String authServer) {
        apiClientOptions.setAuthServer(authServer);
    }

    @ShellMethod("Get configured OIDC Server base URL")
    public String getAuthServer() {
        return apiClientOptions.getAuthServer();
    }

    @ShellMethod("Set refresh token. The access token, if set and valid, takes precedence. (Property: refresh.token)")
    public void refreshToken(@ShellOption String refreshToken) {
        apiClientOptions.setRefreshToken(refreshToken);
    }

    @ShellMethod("Get refresh token")
    public String getRefreshToken() {
        return apiClientOptions.getRefreshToken();
    }

    @ShellMethod("Set client ID registered on the Auth Server (Property: client.id)")
    public void clientId(@ShellOption String clientId) {
        apiClientOptions.setClientId(clientId);
    }

    @ShellMethod("Get client ID")
    public String getClientId() {
        return apiClientOptions.getClientId();
    }

    @ShellMethod("Set JWKS keystore file path (Property: jwks.path)")
    public void jwksPath(@ShellOption String jwksPath) {
        apiClientOptions.setJwksPath(jwksPath);
    }

    @ShellMethod("Get JWKS keystore file path")
    public String getJwksPath() {
        return apiClientOptions.getJwksPath();
    }
}
